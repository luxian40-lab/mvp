{% extends "admin/base_site.html" %}

{% block content %}
<div class="container-fluid">
    
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-dark">üìä Tablero de Control - Eki MVP</h1>
            <p class="text-muted">Resumen de actividad en tiempo real</p>
        </div>
    </div>

    <div class="row">
        
        <div class="col-lg-3 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3>{{ exitosos }}</h3>
                    <p>Mensajes Entregados ‚úÖ</p>
                </div>
                <div class="icon">
                    <i class="fas fa-paper-plane"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-6">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>{{ fallidos }}</h3>
                    <p>Env√≠os Fallidos ‚ùå</p>
                </div>
                <div class="icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>{{ total_campanas }}</h3>
                    <p>Campa√±as Creadas üì¢</p>
                </div>
                <div class="icon">
                    <i class="fas fa-bullhorn"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>{{ estudiantes_activos }}</h3>
                    <p>Estudiantes Activos üéì</p>
                </div>
                <div class="icon">
                    <i class="fas fa-users"></i>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- M√©tricas de WhatsApp -->
    <div class="row mt-4">
        <div class="col-lg-3 col-6">
            <div class="small-box bg-primary">
                <div class="inner">
                    <h3>{{ whatsapp_total }}</h3>
                    <p>Mensajes WhatsApp üí¨</p>
                </div>
                <div class="icon">
                    <i class="fab fa-whatsapp"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-6">
            <div class="small-box bg-teal">
                <div class="inner">
                    <h3>{{ whatsapp_enviados }}</h3>
                    <p>Mensajes Enviados üì§</p>
                </div>
                <div class="icon">
                    <i class="fas fa-share-square"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-6">
            <div class="small-box bg-olive">
                <div class="inner">
                    <h3>{{ whatsapp_entrantes }}</h3>
                    <p>Mensajes Recibidos üì•</p>
                </div>
                <div class="icon">
                    <i class="fas fa-inbox"></i>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Tabla de Mensajes WhatsApp Recientes -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card card-primary card-outline">
                <div class="card-header">
                    <h5 class="m-0">üì± √öltimos Mensajes WhatsApp</h5>
                </div>
                <div class="card-body p-0">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Tel√©fono</th>
                                <th>Mensaje</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>ID Mensaje</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in whatsapp_logs %}
                            <tr>
                                <td><strong>{{ log.telefono }}</strong></td>
                                <td>{{ log.mensaje|truncatewords:10 }}</td>
                                <td>
                                    {% if log.estado == 'SENT' %}
                                        <span class="badge badge-success">ENVIADO ‚úÖ</span>
                                    {% elif log.estado == 'INCOMING' %}
                                        <span class="badge badge-info">RECIBIDO üì•</span>
                                    {% elif log.estado == 'PENDING' %}
                                        <span class="badge badge-warning">PENDIENTE ‚è≥</span>
                                    {% elif log.estado == 'ERROR' %}
                                        <span class="badge badge-danger">ERROR ‚ùå</span>
                                    {% else %}
                                        <span class="badge badge-secondary">{{ log.estado }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ log.fecha|date:"d/m/Y H:i" }}</td>
                                <td><code>{{ log.mensaje_id }}</code></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center text-muted">Sin mensajes a√∫n.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card card-primary card-outline">
                <div class="card-header">
                    <h5 class="m-0">üöÄ Acciones R√°pidas</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">Inicia una nueva campa√±a o gestiona tu base de datos.</p>
                    <a href="/admin/core/campana/add/" class="btn btn-primary"><i class="fas fa-plus"></i> Nueva Campa√±a</a>
                    <a href="/admin/core/estudiante/add/" class="btn btn-secondary"><i class="fas fa-user-plus"></i> Nuevo Estudiante</a>
                    <a href="{% url 'importar_estudiantes' %}" class="btn btn-info"><i class="fas fa-file-import"></i> Importar Estudiantes</a>
                </div>
            </div>
        </div>

        <div class="col-md-6">
             <div class="card card-outline card-info">
                <div class="card-header">
                    <h5 class="m-0">üì• Reportes</h5>
                </div>
                <div class="card-body">
                    <p>Descarga reportes en Excel filtrando por fecha.</p>
                    <a href="{% url 'descargar_reportes' %}" class="btn btn-info"><i class="fas fa-download"></i> Descargar Reportes</a>
                    <a href="/admin/core/enviolog/" class="btn btn-secondary"><i class="fas fa-list"></i> Ver Historial</a>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
