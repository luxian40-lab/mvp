{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}üìÖ Calendario de Campa√±as - EKI Admin{% endblock %}

{% block extrastyle %}
<style>
    .calendario-container {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .section-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .campanas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .campana-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        border-left: 4px solid #667eea;
    }
    
    .campana-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .campana-card.ejecutada {
        border-left-color: #48bb78;
        opacity: 0.9;
    }
    
    .campana-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }
    
    .campana-nombre {
        font-size: 18px;
        font-weight: bold;
        color: #2d3748;
        flex: 1;
    }
    
    .campana-estado {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .estado-pendiente {
        background: #fef3c7;
        color: #92400e;
    }
    
    .estado-ejecutada {
        background: #d1fae5;
        color: #065f46;
    }
    
    .campana-fecha {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #4a5568;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .campana-fecha.urgente {
        color: #e53e3e;
        font-weight: bold;
    }
    
    .campana-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e2e8f0;
    }
    
    .info-item {
        font-size: 13px;
        color: #718096;
    }
    
    .info-value {
        font-weight: bold;
        color: #2d3748;
    }
    
    .no-campanas {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .no-campanas-icon {
        font-size: 64px;
        margin-bottom: 20px;
    }
    
    .no-campanas-text {
        font-size: 18px;
        color: #718096;
    }
    
    .tiempo-restante {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 4px 10px;
        background: #edf2f7;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        color: #2d3748;
        margin-top: 8px;
    }
    
    .tiempo-restante.urgente {
        background: #fed7d7;
        color: #c53030;
    }
</style>
{% endblock %}

{% block content %}
<div class="calendario-container">
    <!-- Campa√±as Pendientes -->
    <div class="section-title">
        ‚è∞ Campa√±as Pendientes
    </div>
    
    {% if campanas_pendientes %}
    <div class="campanas-grid">
        {% for campana in campanas_pendientes %}
        <div class="campana-card">
            <div class="campana-header">
                <div class="campana-nombre">{{ campana.nombre }}</div>
                <span class="campana-estado estado-pendiente">Pendiente</span>
            </div>
            
            <div class="campana-fecha {% if campana.fecha_programada <= now %}urgente{% endif %}">
                üìÖ {{ campana.fecha_programada|date:"d/m/Y H:i" }}
                
                {% if campana.fecha_programada <= now %}
                    <span class="tiempo-restante urgente">
                        ‚ö†Ô∏è Vencida
                    </span>
                {% else %}
                    <span class="tiempo-restante">
                        ‚è±Ô∏è En {{ campana.fecha_programada|timeuntil }}
                    </span>
                {% endif %}
            </div>
            
            <div class="campana-info">
                <div class="info-item">
                    <span class="info-value">{{ campana.destinatarios.count }}</span>
                    destinatarios
                </div>
                <div class="info-item">
                    {% if campana.plantilla %}
                        üìù {{ campana.plantilla.nombre_interno|truncatechars:20 }}
                    {% else %}
                        üìù Sin plantilla
                    {% endif %}
                </div>
                <div class="info-item">
                    {% if campana.tema %}
                        {{ campana.tema.emoji }} {{ campana.tema.nombre }}
                    {% else %}
                        üè∑Ô∏è Sin tema
                    {% endif %}
                </div>
                <div class="info-item">
                    <a href="{% url 'admin:core_campana_change' campana.id %}" style="text-decoration: none; color: #667eea;">
                        ‚úèÔ∏è Editar
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-campanas">
        <div class="no-campanas-icon">‚úÖ</div>
        <div class="no-campanas-text">No hay campa√±as pendientes</div>
    </div>
    {% endif %}
    
    <!-- Campa√±as Ejecutadas Recientemente -->
    <div class="section-title" style="margin-top: 60px;">
        ‚úÖ Campa√±as Ejecutadas Recientemente
    </div>
    
    {% if campanas_ejecutadas %}
    <div class="campanas-grid">
        {% for campana in campanas_ejecutadas %}
        <div class="campana-card ejecutada">
            <div class="campana-header">
                <div class="campana-nombre">{{ campana.nombre }}</div>
                <span class="campana-estado estado-ejecutada">Ejecutada</span>
            </div>
            
            <div class="campana-fecha">
                üìÖ {{ campana.fecha_programada|date:"d/m/Y H:i" }}
            </div>
            
            <div class="campana-info">
                <div class="info-item">
                    <span class="info-value">{{ campana.destinatarios.count }}</span>
                    destinatarios
                </div>
                <div class="info-item">
                    {% if campana.plantilla %}
                        üìù {{ campana.plantilla.nombre_interno|truncatechars:20 }}
                    {% else %}
                        üìù Sin plantilla
                    {% endif %}
                </div>
                <div class="info-item">
                    {% if campana.tema %}
                        {{ campana.tema.emoji }} {{ campana.tema.nombre }}
                    {% else %}
                        üè∑Ô∏è Sin tema
                    {% endif %}
                </div>
                <div class="info-item">
                    <a href="{% url 'admin:core_campana_change' campana.id %}" style="text-decoration: none; color: #48bb78;">
                        üëÅÔ∏è Ver detalles
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-campanas">
        <div class="no-campanas-icon">üì≠</div>
        <div class="no-campanas-text">No hay campa√±as ejecutadas recientemente</div>
    </div>
    {% endif %}
</div>
{% endblock %}
